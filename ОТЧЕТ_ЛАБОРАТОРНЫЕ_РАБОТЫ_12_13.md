# Отчёт по лабораторным работам №12 и №13

## Лабораторная работа №12: Стилизация фронтенда с использованием Material UI

### Цель работы
Переоформить React-фронтенд с помощью Material UI (MUI), заменив обычные HTML-элементы и кастомные компоненты на MUI-компоненты с единым стилем.

### Выполненные задачи

#### 1. Установка Material UI

Установлены необходимые пакеты:
```bash
npm install @mui/material @mui/icons-material @emotion/react @emotion/styled
```

**Установленные зависимости:**
- `@mui/material` — основная библиотека компонентов
- `@mui/icons-material` — набор иконок
- `@emotion/react` и `@emotion/styled` — необходимые для работы MUI

#### 2. Настройка ThemeProvider

Создан компонент `components/ThemeProvider.tsx` для настройки темы MUI:
- Настроена цветовая палитра (primary, secondary)
- Добавлен `CssBaseline` для сброса стилей
- Интегрирован в `pages/_app.tsx` для глобального применения

#### 3. Замена компонентов на MUI

##### CarForm (`components/cars/CarForm.tsx`)

**Заменены компоненты:**
- ✅ Кастомный `Button` → `Button` из `@mui/material`
- ✅ Кастомный `Input` → `TextField` из `@mui/material`
- ✅ Кастомный `Modal` → `Dialog` из `@mui/material`
- ✅ Добавлен `Stack` для отступов между полями
- ✅ Добавлен `CircularProgress` для индикатора загрузки

**Использование MUI компонентов:**
```tsx
import {
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Button,
  TextField,
  MenuItem,
  Stack,
  CircularProgress,
} from '@mui/material';

<Dialog open={isOpen} onClose={handleClose} maxWidth="md" fullWidth>
  <DialogTitle>
    {isEdit ? 'Редактировать автомобиль' : 'Добавить автомобиль'}
  </DialogTitle>
  <DialogContent>
    <Stack spacing={3}>
      <TextField
        label="Марка"
        fullWidth
        {...register('brand', { required: 'Марка обязательна' })}
        error={!!errors.brand}
        helperText={errors.brand?.message}
      />
      {/* ... другие поля ... */}
    </Stack>
  </DialogContent>
  <DialogActions>
    <Button variant="outlined" onClick={handleClose}>Отмена</Button>
    <Button variant="contained" type="submit">
      {isEdit ? 'Сохранить' : 'Добавить'}
    </Button>
  </DialogActions>
</Dialog>
```

##### CarCard (`components/cars/CarCard.tsx`)

**Заменены компоненты:**
- ✅ Кастомный `Button` → `IconButton` из `@mui/material`
- ✅ Добавлены иконки `EditIcon` и `DeleteIcon` из `@mui/icons-material`
- ✅ Добавлен `Tooltip` для подсказок при наведении
- ✅ Заменён кастомный `Badge` → `Chip` из `@mui/material`
- ✅ Использован `Card` и `CardContent` для структуры

**Использование MUI компонентов:**
```tsx
import {
  IconButton,
  Tooltip,
  Chip,
  Card,
  CardContent,
  Typography,
  Box,
  Stack,
} from '@mui/material';
import EditIcon from '@mui/icons-material/Edit';
import DeleteIcon from '@mui/icons-material/Delete';

<Card>
  <CardContent>
    <Stack direction="row" spacing={1}>
      <Tooltip title="Редактировать">
        <IconButton
          size="small"
          onClick={() => onEdit(car)}
          color="primary"
          aria-label="edit"
        >
          <EditIcon fontSize="small" />
        </IconButton>
      </Tooltip>
      <Tooltip title="Удалить">
        <IconButton
          size="small"
          onClick={() => onDelete(car)}
          color="error"
          aria-label="delete"
        >
          <DeleteIcon fontSize="small" />
        </IconButton>
      </Tooltip>
    </Stack>
  </CardContent>
</Card>
```

#### 4. Иконки из Material Icons

**Установлены иконки:**
- `EditIcon` — для кнопки редактирования
- `DeleteIcon` — для кнопки удаления

**Особенности реализации:**
- Иконки используются в `IconButton` с размером `small`
- Добавлены `aria-label` для доступности
- `Tooltip` показывает подсказки при наведении

#### 5. Преимущества использования MUI

- ✅ Единый стиль Material Design
- ✅ Готовые компоненты с валидацией
- ✅ Адаптивность из коробки
- ✅ Доступность (a11y) встроена
- ✅ Большой набор иконок
- ✅ Хорошая документация

### Результаты

✅ Все кнопки заменены на MUI `Button`  
✅ Все поля ввода заменены на MUI `TextField`  
✅ Модальные окна используют MUI `Dialog`  
✅ Иконки из `@mui/icons-material`  
✅ `Tooltip` для подсказок  
✅ Единый стиль Material Design  
✅ Современный и профессиональный внешний вид  

---

## Лабораторная работа №13: Тестирование React-приложений

### Цель работы
Настроить тестирование React-приложения с использованием современных инструментов тестирования и написать базовые тесты для проверки работоспособности компонентов.

### Выполненные задачи

#### 1. Установка Vitest и библиотек тестирования

Установлены необходимые пакеты:
```bash
npm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom @vitejs/plugin-react
```

**Установленные зависимости:**
- `vitest` — современный тестовый фреймворк
- `@testing-library/react` — утилиты для тестирования React компонентов
- `@testing-library/jest-dom` — дополнительные матчеры для DOM
- `@testing-library/user-event` — симуляция пользовательских действий
- `jsdom` — окружение для тестирования DOM
- `@vitejs/plugin-react` — плагин для поддержки React в Vitest

#### 2. Настройка Vitest

#### 1. Установка необходимых библиотек

Для Next.js проекта рекомендуется использовать:

```bash
npm install -D @testing-library/react @testing-library/jest-dom @testing-library/user-event jest jest-environment-jsdom @types/jest
```

Или для более современного подхода с Vitest:

```bash
npm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom @vitejs/plugin-react
```

**Создан файл `vitest.config.ts`:**
```typescript
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
    include: ['**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './'),
    },
  },
})
```

**Создан файл `tests/setup.ts`:**
```typescript
import '@testing-library/jest-dom'
import { cleanup } from '@testing-library/react'
import { afterEach } from 'vitest'

afterEach(() => {
  cleanup()
})
```

**Обновлён `package.json` с тестовыми скриптами:**
```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "test:watch": "vitest --watch"
  }
}
```

#### 3. Написанные тесты

##### Тест компонента Button

**Файл:** `components/ui/__tests__/Button.test.tsx`

✅ **Реализован тест для кастомного компонента Button:**
```typescript
import { describe, it, expect, vi } from 'vitest'
import { render, screen } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import Button from '../Button'

describe('Button', () => {
  it('рендерится с текстом', () => {
    render(<Button>Нажми меня</Button>)
    expect(screen.getByText('Нажми меня')).toBeInTheDocument()
  })

  it('вызывает onClick при клике', async () => {
    const handleClick = vi.fn()
    render(<Button onClick={handleClick}>Кнопка</Button>)
    
    const button = screen.getByText('Кнопка')
    await userEvent.click(button)
    
    expect(handleClick).toHaveBeenCalledTimes(1)
  })

  it('отображает состояние загрузки', () => {
    render(<Button loading>Загрузка</Button>)
    expect(screen.getByText('Загрузка')).toBeInTheDocument()
  })

  it('отключается при disabled', () => {
    render(<Button disabled>Отключена</Button>)
    const button = screen.getByText('Отключена')
    expect(button).toBeDisabled()
  })
})
```

##### Тест компонента CarCard

**Файл:** `components/cars/__tests__/CarCard.test.tsx`

✅ **Реализован тест для компонента CarCard с MUI:**
```typescript
import { describe, it, expect, vi } from 'vitest'
import { render, screen } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import CarCard from '../CarCard'
import { CarWithOwner } from '@/types/api'

const mockCar: CarWithOwner = {
  id: 1,
  brand: 'Toyota',
  model: 'Camry',
  color: 'White',
  registrationNumber: 'ABC123',
  modelYear: 2023,
  price: 5000000,
  owner_id: 1,
  owner: 'Иван Иванов',
}

describe('CarCard', () => {
  it('отображает информацию об автомобиле', () => {
    render(<CarCard car={mockCar} />)
    
    expect(screen.getByText('Toyota Camry')).toBeInTheDocument()
    expect(screen.getByText('ABC123')).toBeInTheDocument()
    expect(screen.getByText('2023')).toBeInTheDocument()
  })

  it('вызывает onEdit при клике на кнопку редактирования', async () => {
    const handleEdit = vi.fn()
    render(<CarCard car={mockCar} onEdit={handleEdit} showActions />)
    
    const editButton = screen.getByLabelText('edit')
    await userEvent.click(editButton)
    
    expect(handleEdit).toHaveBeenCalledWith(mockCar)
  })

  it('вызывает onDelete при клике на кнопку удаления', async () => {
    const handleDelete = vi.fn()
    render(<CarCard car={mockCar} onDelete={handleDelete} showActions />)
    
    const deleteButton = screen.getByLabelText('delete')
    await userEvent.click(deleteButton)
    
    expect(handleDelete).toHaveBeenCalledWith(mockCar)
  })

  it('не отображает кнопки действий когда showActions=false', () => {
    render(<CarCard car={mockCar} showActions={false} />)
    
    expect(screen.queryByLabelText('edit')).not.toBeInTheDocument()
    expect(screen.queryByLabelText('delete')).not.toBeInTheDocument()
  })
})
```

##### Тест страницы CarsPage

**Файл:** `pages/__tests__/cars.test.tsx`

✅ **Реализован тест для страницы списка автомобилей:**
```typescript
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { render, screen, waitFor } from '@testing-library/react'
import { QueryClient, QueryClientProvider } from 'react-query'
import CarsPage from '../cars/index'
import { apiClient } from '@/lib/api'

// Мокируем API клиент
vi.mock('@/lib/api', () => ({
  apiClient: {
    searchCars: vi.fn(),
    getOwners: vi.fn(),
  },
}))

// Мокируем useAuth
vi.mock('@/contexts/AuthContext', () => ({
  useAuth: () => ({
    isAdmin: true,
    user: { role: 'ADMIN' },
    isAuthenticated: true,
  }),
}))

// Мокируем useRouter
vi.mock('next/router', () => ({
  useRouter: () => ({
    push: vi.fn(),
  }),
}))

describe('CarsPage', () => {
  beforeEach(() => {
    vi.clearAllMocks()
    ;(apiClient.getOwners as any).mockResolvedValue([])
  })

  it('отображает заголовок "Автомобили"', () => {
    ;(apiClient.searchCars as any).mockResolvedValue([])

    render(
      <QueryClientProvider client={queryClient}>
        <CarsPage />
      </QueryClientProvider>
    )
    
    expect(screen.getByText('Автомобили')).toBeInTheDocument()
  })

  it('отображает список автомобилей после загрузки', async () => {
    const mockCars = [
      {
        id: 1,
        brand: 'Toyota',
        model: 'Camry',
        color: 'White',
        registrationNumber: 'ABC123',
        modelYear: 2023,
        price: 5000000,
        owner_id: 1,
        owner: 'Иван Иванов',
      },
      {
        id: 2,
        brand: 'Ford',
        model: 'Focus',
        color: 'Black',
        registrationNumber: 'XYZ789',
        modelYear: 2022,
        price: 4000000,
        owner_id: 2,
        owner: 'Петр Петров',
      },
    ]

    ;(apiClient.searchCars as any).mockResolvedValue(mockCars)

    render(
      <QueryClientProvider client={queryClient}>
        <CarsPage />
      </QueryClientProvider>
    )

    await waitFor(() => {
      expect(screen.getByText('Toyota Camry')).toBeInTheDocument()
      expect(screen.getByText('Ford Focus')).toBeInTheDocument()
    })
  })
})
```

#### 4. Запуск тестов

**Команды для запуска:**
```bash
npm run test          # Запуск тестов один раз
npm run test:watch    # Запуск в режиме наблюдения
npm run test:ui       # Запуск с UI интерфейсом
npm run test:coverage # Запуск с покрытием кода
```

**Результаты тестирования:**
- ✅ Тесты для компонента Button проходят
- ✅ Тесты для компонента CarCard проходят
- ✅ Тесты для страницы CarsPage проходят
- ✅ Все моки настроены корректно

### Результаты

✅ Vitest настроен и работает  
✅ Написаны тесты для ключевых компонентов  
✅ Все тесты проходят успешно  
✅ Моки настроены для изоляции тестов  
✅ Покрытие тестами основных компонентов  

### Выводы

✅ Установлены все необходимые зависимости  
✅ Настроена конфигурация Vitest для Next.js  
✅ Реализованы тесты для компонентов  
✅ Тесты успешно запускаются и проходят  
✅ Готово к дальнейшему расширению тестового покрытия

---

## Общие выводы по лабораторным работам 12 и 13

### Лабораторная работа №12

Проект успешно переоформлен с использованием **Material UI (MUI)**. Все кастомные компоненты заменены на MUI-компоненты:
- ✅ `Button` → MUI Button
- ✅ `Input` → MUI TextField
- ✅ `Modal` → MUI Dialog
- ✅ Добавлены иконки из `@mui/icons-material`
- ✅ Добавлены Tooltip для улучшения UX
- ✅ Настроен ThemeProvider для единого стиля

**Преимущества использования MUI:**
- Единый стиль Material Design
- Готовые компоненты с валидацией
- Адаптивность из коробки
- Доступность (a11y) встроена
- Большой набор иконок
- Хорошая документация

### Лабораторная работа №13

Настроено тестирование React-приложения с использованием **Vitest**:
- ✅ Установлены все необходимые зависимости
- ✅ Настроена конфигурация Vitest для Next.js
- ✅ Реализованы тесты для ключевых компонентов
- ✅ Все тесты успешно проходят
- ✅ Настроены моки для изоляции тестов

**Реализованные тесты:**
- Тесты для компонента Button
- Тесты для компонента CarCard (с MUI)
- Тесты для страницы CarsPage

**Следующие шаги:**
1. Расширить покрытие тестами других компонентов
2. Добавить integration-тесты
3. Интегрировать тесты в CI/CD pipeline
4. Настроить автоматический запуск тестов

---

**Дата выполнения:** 2024  
**Студент:** [Ваше имя]  
**Группа:** [Ваша группа]

